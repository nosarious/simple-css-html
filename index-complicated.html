<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="index.css">
<script type="text/javascript" src="https://rawgit.com/patriciogonzalezvivo/glslCanvas/master/build/GlslCanvas.js"></script>


</head>
<body>
    <canvas id="glslCanvas" data-fragment="
// Colorful Voronoi
// By: Brandon Fogerty
// bfogerty at gmail dot com
// xdpixel.com

#ifdef GL_ES
precision mediump float;
#endif

uniform float time;
uniform vec2 mouse;
uniform vec2 resolution;

vec2 hash(vec2 p)
{
    mat2 m = mat2(  13.85, 47.77,
                    99.41, 88.48
                );

    return fract(sin(m*p) * 46738.29);
}

float voronoi(vec2 p)
{
    vec2 g = floor(p);
    vec2 f = fract(p);

    float distanceToClosestFeaturePoint = 1.0;
    for(int y = -1; y <= 1; y++)
    {
        for(int x = -1; x <= 1; x++)
        {
            vec2 latticePoint = vec2(x, y);
            float currentDistance = distance(latticePoint + hash(g+latticePoint), f);
            distanceToClosestFeaturePoint = min(distanceToClosestFeaturePoint, currentDistance);
        }
    }

    return distanceToClosestFeaturePoint;
}

void main( void )
{
    vec2 uv = ( gl_FragCoord.xy / resolution.xy ) * 2.0 - 1.0;
    uv.x *= resolution.x / resolution.y;

    float offset = voronoi(uv*10.0 + vec2(time));
    float t = 1.0/abs(((uv.x + sin(uv.y + time)) + offset) * 30.0);

    float r = voronoi( uv * 1.0 ) * 10.0;
    vec3 finalColor = vec3(10.0 * uv.y, 2.0, 1.0 * r) * t;
    
    gl_FragColor = vec4(finalColor, 1.0 );
}" ></canvas>

    <div id="container" class="container">
    <div class = "masthead">

    </div>

    <article class="mainSpace">

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    <p>this is some text that should flow underneath the title and make it look like I actually have something important to say. Oooh! I is saying something!</p>
    </div>

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    </div>

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    </div>

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    </div>

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    </div>

    <div class = "card">
    <img >
    <div class = "heading">This is card one</div>
    </div>

    </article>

    <div class = "mastfoot">

    </div>
    </div>
</body>
<script>
    var canvas = document.getElementById("glslCanvas");
    var sandbox = new GlslCanvas(canvas);
    var texCounter = 0;
    var sandbox_content = "";
    var sandbox_title = "";
    var sandbox_author = "";
    var sandbox_thumbnail = ""; 
    canvas.style.width = '100%';
    canvas.style.height = '100%';

    function parseQuery (qstr) {
        var query = {};
        var a = qstr.split('&');
        for (var i in a) {
            var b = a[i].split('=');
            query[decodeURIComponent(b[0])] = decodeURIComponent(b[1]);
        }
        return query;
    }

    function load(url) {
        // Make the request and wait for the reply
        fetch(url)
            .then(function (response) {
                // If we get a positive response...
                if (response.status !== 200) {
                    console.log('Error getting shader. Status code: ' + response.status);
                    return;
                }
                // console.log(response);
                return response.text();
            })
            .then(function(content) {
                sandbox_content = content;
                sandbox.load(content);

                var title = addTitle();
                var author = addAuthor();
                if ( title === "unknown" && author === "unknown") {
                    document.getElementById("credits").style.visibility = "hidden";
                } else {
                    document.getElementById("credits").style.visibility = "visible";
                }

                addMeta({
                            'title' : title + ' by ' + author,
                            'type' : 'website',
                            'url': window.location.href,
                            'image': sandbox_thumbnail
                        })                 
            })
    }

    function addTitle() {
        var result = sandbox_content.match(/\/\/\s*[T|t]itle\s*:\s*([\w|\s|\@|\(|\)|\-|\_]*)/i);
        if (result && !(result[1] === ' ' || result[1] === '')) {
            sandbox_title = result[1].replace(/(\r\n|\n|\r)/gm, '');
            var title_el = document.getElementById("title").innerHTML = sandbox_title;
            return sandbox_title;
        }
        else {
            return "unknown";
        }
    }

    function addAuthor() {
        var result = sandbox_content.match(/\/\/\s*[A|a]uthor\s*[\:]?\s*([\w|\s|\@|\(|\)|\-|\_]*)/i);
        if (result && !(result[1] === ' ' || result[1] === '')) {
            sandbox_author = result[1].replace(/(\r\n|\n|\r)/gm, '');
            document.getElementById("author").innerHTML = sandbox_author;
            return sandbox_author;
        }
        else {
            return "unknown";
        }
    }

    function addMeta(obj) {
        for (var key in obj) {
            var meta = document.createElement('meta');
            meta.setAttribute('og:'+key, obj[key]);
            document.getElementsByTagName('head')[0].appendChild(meta);
        }              
    }

    var query = parseQuery(window.location.search.slice(1));
    if (query && query.log) {
        sandbox_thumbnail = 'http://thebookofshaders.com/log/' + query.log + '.png';
        load('http://thebookofshaders.com/log/' + query.log + '.frag');
    }

    if (window.location.hash !== '') {
        var hashes = location.hash.split('&');
        for (var i in hashes) {
            var ext = hashes[i].substr(hashes[i].lastIndexOf('.') + 1);
            var path = hashes[i];

            // Extract hash if is present
            if (path.search('#') === 0) {
                path = path.substr(1);
            }

            if (ext === 'frag') {
                load(path);
            }
            else if (ext === 'png' || ext === 'jpg' || ext === 'PNG' || ext === 'JPG') {
                sandbox.setUniform("u_tex"+texCounter.toString(), path);
                texCounter++;
            }
        }
    }

</script>
 </html>           
 